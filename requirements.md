# 要件定義書 - ラストウォー風シューティングゲーム

## 1. プロジェクト概要

### 1.1 プロジェクト名
ラストウォー風シューティングゲーム

### 1.2 目的
モバイルゲーム「ラストウォー：サバイバル」の広告で見られるシューティングゲームを再現し、
クリア時のご褒美動画が収集アイテムによって変化するシステムを実装する。

### 1.3 対象ユーザー
- カジュアルゲームプレイヤー
- ブラウザゲームを楽しむユーザー
- PC/タブレットユーザー

### 1.4 開発環境
- HTML5 + Canvas
- JavaScript (ES6+)
- CSS3

## 2. 機能要件

### 2.1 ゲームプレイ機能

#### 2.1.1 プレイヤー操作
| 項目 | 要件 | 優先度 |
|------|------|--------|
| 移動 | 左右矢印キーまたはA/Dキーで左右移動 | 必須 |
| タッチ操作 | 画面タッチ/ドラッグでプレイヤー移動 | 必須 |
| 射撃 | 自動射撃（手動操作不要） | 必須 |
| 移動速度 | 6 px/frame | 必須 |
| 配置 | 画面下部中央（初期位置） | 必須 |

#### 2.1.2 弾システム
| 項目 | 要件 | 優先度 |
|------|------|--------|
| 発射数 | 兵士数に応じて増加（最大10発同時） | 必須 |
| 発射間隔 | 15フレームごと | 必須 |
| 弾速度 | 10 px/frame（上方向） | 必須 |
| サイズ | 8x20 px | 必須 |
| 配置 | 兵士数に応じて扇状に広がる | 必須 |

#### 2.1.3 障害物システム
| 項目 | 要件 | 優先度 |
|------|------|--------|
| サイズ | 350x120 px（レーン幅いっぱい） | 必須 |
| HP | 20-70のランダム値 | 必須 |
| HP表示 | 中央に大きく数字表示（48px） | 必須 |
| 降下速度 | 1.5 px/frame | 必須 |
| 出現位置 | 左レーン（x=200）または右レーン（x=600） | 必須 |
| 出現頻度 | 120フレーム（2秒）ごと | 必須 |
| 報酬 | 50%の確率でアイテム付き | 必須 |
| 報酬種類 | 妹・姉・母のいずれか | 必須 |
| 破壊時 | スコア加算（HP × 5点） | 必須 |

#### 2.1.4 兵士増加システム（青ゲージ）
| 項目 | 要件 | 優先度 |
|------|------|--------|
| サイズ | 350x100 px | 必須 |
| 表示 | +数字（48px、中央） | 必須 |
| 増加量 | 2-6人のランダム | 必須 |
| 降下速度 | 1.5 px/frame | 必須 |
| 出現位置 | 左レーン（x=200）または右レーン（x=600） | 必須 |
| 出現頻度 | 180フレーム（3秒）ごと | 必須 |
| 取得時 | スコア加算（兵士数 × 10点） | 必須 |

#### 2.1.5 ボスシステム
| 項目 | 要件 | 優先度 |
|------|------|--------|
| 出現タイミング | 通常ステージ40秒後 | 必須 |
| サイズ | 120x120 px | 必須 |
| HP | 500 | 必須 |
| HPバー | 画面上部に表示 | 必須 |
| 通常移動 | 左右移動（速度2 px/frame） | 必須 |
| 攻撃パターン | プレイヤー位置へ降下攻撃 | 必須 |
| 攻撃速度 | 3 px/frame（降下・上昇） | 必須 |
| 攻撃間隔 | 180フレーム（3秒）のクールダウン | 必須 |
| ダメージ | 当たると兵士数-2 | 必須 |
| 撃破時 | スコア+1000点 | 必須 |

### 2.2 UI/UX要件

#### 2.2.1 画面構成
| 項目 | 要件 | 優先度 |
|------|------|--------|
| キャンバスサイズ | 800x600 px | 必須 |
| レーン分割 | 縦2分割（左:0-400、右:400-800） | 必須 |
| 分割線 | 中央に点線表示 | 必須 |
| スコア表示 | 画面左上 | 必須 |
| 兵士数表示 | 画面右上 | 必須 |
| アイテム数表示 | 妹・姉・母の3種を画面上部に表示 | 必須 |
| 進行度バー | ステージ進行度を%表示 | 必須 |

#### 2.2.2 画面遷移
```
[スタート画面]
     ↓
  ゲーム開始
     ↓
[ゲーム画面]
  - 通常ステージ（40秒）
  - ボス戦
     ↓
  ボス撃破
     ↓
[リザルト画面]
  - 獲得アイテム表示
  - 最終スコア表示
  - ご褒美動画再生
     ↓
[スタート画面に戻る]
```

### 2.3 ご褒美動画システム

#### 2.3.1 動画分岐ロジック
| 条件 | 再生動画 | 優先度 |
|------|---------|--------|
| 妹アイテムが最多 | videos/sister.mp4 | 必須 |
| 姉アイテムが最多 | videos/older-sister.mp4 | 必須 |
| 母アイテムが最多 | videos/mother.mp4 | 必須 |
| 同数の場合 | 優先順位：母 > 姉 > 妹 | 必須 |

#### 2.3.2 動画再生要件
| 項目 | 要件 | 優先度 |
|------|------|--------|
| 形式 | MP4（H.264） | 必須 |
| コントロール | 再生/一時停止/音量調整 | 必須 |
| 配置 | 画面中央 | 必須 |
| 最大幅 | 600px | 必須 |

## 3. 非機能要件

### 3.1 パフォーマンス要件
| 項目 | 要件 | 優先度 |
|------|------|--------|
| フレームレート | 60 FPS | 必須 |
| 起動時間 | 3秒以内 | 推奨 |
| メモリ使用量 | 200MB以下 | 推奨 |

### 3.2 互換性要件
| 項目 | 要件 | 優先度 |
|------|------|--------|
| ブラウザ | Chrome 90+, Firefox 88+, Edge 90+, Safari 14+ | 必須 |
| 解像度 | 1024x768以上 | 必須 |
| 入力デバイス | キーボード、マウス、タッチスクリーン | 必須 |

### 3.3 ユーザビリティ要件
| 項目 | 要件 | 優先度 |
|------|------|--------|
| 操作説明 | スタート画面に表示 | 必須 |
| ゲーム中断 | ブラウザタブ切り替え時に一時停止 | 推奨 |
| リスタート | リザルト画面からワンクリックで再開 | 必須 |

## 4. データ要件

### 4.1 ゲーム状態
```javascript
gameState = {
    screen: String,      // 'start', 'game', 'reward'
    score: Number,       // 現在のスコア
    soldiers: Number,    // 現在の兵士数（初期値1）
    items: {
        sister: Number,      // 妹アイテム数
        olderSister: Number, // 姉アイテム数
        mother: Number       // 母アイテム数
    },
    frame: Number,       // 経過フレーム数
    isBossBattle: Boolean // ボス戦フラグ
}
```

### 4.2 設定値
```javascript
CONFIG = {
    canvasWidth: 800,
    canvasHeight: 600,
    playerSpeed: 6,
    bulletSpeed: 10,
    obstacleSpeed: 1.5,
    soldierGaugeSpeed: 1.5,
    obstacleSpawnRate: 120,
    soldierGaugeSpawnRate: 180,
    stageDuration: 2400,
    bossHp: 500,
    bossAttackSpeed: 3,
    videoPath: {
        sister: 'videos/sister.mp4',
        olderSister: 'videos/older-sister.mp4',
        mother: 'videos/mother.mp4'
    }
}
```

## 5. 制約事項

### 5.1 技術的制約
- HTML5 Canvas API使用
- 外部ライブラリ不使用（Pure JavaScript）
- ブラウザのローカルストレージ不使用（ハイスコア保存なし）

### 5.2 コンテンツ制約
- 動画ファイルはユーザーが用意する必要がある
- 動画ファイルパスは設定で変更可能

### 5.3 プラットフォーム制約
- PC/タブレット向け（スマートフォンは非推奨）
- オフライン動作可能（動画ファイルがローカルにある場合）

## 6. 受入基準

### 6.1 機能面
- [ ] プレイヤーが左右に移動できる
- [ ] 自動で弾が発射される
- [ ] 弾が障害物に当たるとHPが減る
- [ ] 障害物のHPが0になると破壊される
- [ ] 障害物破壊時にアイテムを取得できる
- [ ] 青ゲージを取ると兵士数が増える
- [ ] 兵士数に応じて弾の数が増える
- [ ] 40秒経過後にボスが出現する
- [ ] ボスが降下攻撃を行う
- [ ] ボスを倒すとクリア画面に遷移する
- [ ] 最多アイテムに応じて動画が変わる

### 6.2 品質面
- [ ] 60FPSで動作する
- [ ] 衝突判定が正確に機能する
- [ ] UIが見やすく配置されている
- [ ] 操作がスムーズで遅延がない
- [ ] バグやクラッシュが発生しない

### 6.3 体験面
- [ ] ゲームのルールが理解しやすい
- [ ] 操作が直感的である
- [ ] プレイしていて楽しい
- [ ] 達成感を感じられる
- [ ] もう一度プレイしたくなる

## 7. テストケース

### 7.1 機能テスト
1. プレイヤー移動テスト
   - 左矢印キーで左に移動する
   - 右矢印キーで右に移動する
   - 画面端で停止する

2. 射撃テスト
   - ゲーム開始後、自動で弾が発射される
   - 兵士数1のとき、1発発射される
   - 兵士数5のとき、5発発射される

3. 衝突判定テスト
   - 弾が障害物に当たるとHPが1減る
   - HPが0になると障害物が消える
   - プレイヤーが青ゲージに触れると取得できる

4. ボス戦テスト
   - 40秒経過後にボスが出現する
   - ボスが左右に移動する
   - ボスが降下攻撃を行う
   - ボスのHPが0になるとクリアになる

5. 動画分岐テスト
   - 妹アイテムが最多の場合、sister.mp4が再生される
   - 姉アイテムが最多の場合、older-sister.mp4が再生される
   - 母アイテムが最多の場合、mother.mp4が再生される

### 7.2 パフォーマンステスト
1. フレームレートテスト
   - 通常時に60FPS維持できる
   - 障害物多数時に60FPS維持できる
   - ボス戦時に60FPS維持できる

2. メモリリークテスト
   - 長時間プレイしてもメモリが増え続けない
   - リスタート後にメモリが解放される

### 7.3 互換性テスト
1. ブラウザテスト
   - Chrome で正常動作する
   - Firefox で正常動作する
   - Edge で正常動作する
   - Safari で正常動作する

2. 入力デバイステスト
   - キーボード操作が正常に機能する
   - マウス操作が正常に機能する
   - タッチ操作が正常に機能する（タブレット）

## 8. リスク管理

### 8.1 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 衝突判定の精度問題 | 高 | 座標系を統一し、十分なテストを行う |
| パフォーマンス低下 | 中 | オブジェクト数を制限し、最適化を行う |
| ブラウザ互換性問題 | 中 | 主要ブラウザでテストを行う |

### 8.2 コンテンツリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 動画ファイルが未用意 | 低 | README.mdに明記し、パス変更方法を説明 |
| ゲームバランスの悪さ | 中 | プレイテストを重ね、調整を行う |

## 9. 納品物

### 9.1 必須ファイル
- [x] index.html - メインHTMLファイル
- [x] style.css - スタイルシート
- [x] game.js - ゲームロジック
- [x] README.md - ユーザー向け説明書
- [x] claude.md - 開発履歴
- [x] requirements.md - 本ファイル

### 9.2 オプションファイル
- [ ] videos/sister.mp4 - 妹エンディング動画
- [ ] videos/older-sister.mp4 - 姉エンディング動画
- [ ] videos/mother.mp4 - 母エンディング動画

## 10. 今後の拡張性

### 10.1 短期拡張（1-2週間）
- サウンドエフェクト追加
- BGM実装
- パーティクルエフェクト
- スコアランキング

### 10.2 中期拡張（1-2ヶ月）
- 複数ステージ
- 難易度選択
- 特殊アイテム
- ボスバリエーション

### 10.3 長期拡張（3ヶ月以上）
- マルチプレイヤー
- レベルエディター
- モバイル最適化
- ストーリーモード

---

## 承認

| 役割 | 氏名 | 承認日 |
|------|------|--------|
| 要件定義者 | Claude (Anthropic) | 2025-10-31 |
| レビュアー | User | 2025-10-31 |

---

**文書管理**
- 作成日: 2025-10-31
- 最終更新: 2025-10-31
- バージョン: 1.0
- ステータス: 承認済み
